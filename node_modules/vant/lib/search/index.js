'use strict';

exports.__esModule = true;

var _components;

var _icon = require('../icon');

var _icon2 = _interopRequireDefault(_icon);

var _clickoutside = require('../utils/clickoutside');

var _clickoutside2 = _interopRequireDefault(_clickoutside);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

exports.default = {
  render: function render() {
    var _vm = this;var _h = _vm.$createElement;var _c = _vm._self._c || _h;return _c('div', { directives: [{ name: "clickoutside", rawName: "v-clickoutside", value: _vm.handleClickoutside, expression: "handleClickoutside" }], staticClass: "van-search", class: { 'van-search--focus': _vm.isFocus, 'van-search--showcase': _vm.type === 'showcase' } }, [_c('div', { staticClass: "van-search__input-wrap" }, [_c('van-icon', { attrs: { "name": "search" } }), _c('input', { directives: [{ name: "model", rawName: "v-model", value: _vm.value, expression: "value" }, { name: "refocus", rawName: "v-refocus", value: _vm.focusStatus, expression: "focusStatus" }], staticClass: "van-search__input", attrs: { "type": "text", "placeholder": _vm.placeholder }, domProps: { "value": _vm.value }, on: { "focus": _vm.handleFocus, "keyup": function keyup($event) {
          if (!('button' in $event) && _vm._k($event.keyCode, "enter", 13)) {
            return null;
          }_vm.handleSearch($event);
        }, "input": function input($event) {
          if ($event.target.composing) {
            return;
          }_vm.value = $event.target.value;
        } } }), _c('van-icon', { directives: [{ name: "show", rawName: "v-show", value: _vm.isFocus, expression: "isFocus" }], attrs: { "name": "clear" }, on: { "click": _vm.handleClean } })], 1), _c('div', { directives: [{ name: "show", rawName: "v-show", value: _vm.type !== 'showcase' && _vm.isFocus, expression: "type !== 'showcase' && isFocus" }], staticClass: "van-search__cancel", on: { "click": _vm.handleBack } }, [_vm._v("取消")])]);
  },

  name: 'van-search',

  components: (_components = {}, _components[_icon2.default.name] = _icon2.default, _components),

  props: {
    placeholder: String,
    type: {
      type: String,
      default: 'normal'
    }
  },

  watch: {
    value: function value(val) {
      this.$emit('change', val);
    }
  },

  data: function data() {
    return {
      value: '',
      focusStatus: false,
      isFocus: false
    };
  },


  directives: {
    Clickoutside: _clickoutside2.default,
    refocus: {
      update: function update(el, state) {
        if (state.value) {
          el.focus();
        }
      }
    }
  },

  methods: {
    /**
     * 进入input焦点，出现close和取消
     */
    handleFocus: function handleFocus() {
      this.isFocus = true;
    },


    /**
     * 点击close后清空vlaue后，再聚焦input框
     */
    handleClean: function handleClean() {
      this.value = '';
      this.focusStatus = true;
    },


    /**
     * 点击取消后，清空所有回复最初状态
     */
    handleBack: function handleBack() {
      this.value = '';
      this.focusStatus = false;
      this.isFocus = false;
      this.$emit('cancel');
    },


    /**
     * input输入回车后，发送回调
     */
    handleSearch: function handleSearch() {
      this.$emit('search', this.value);
    },
    handleClickoutside: function handleClickoutside() {
      this.isFocus = false;
      this.focusStatus = false;
    }
  }
};